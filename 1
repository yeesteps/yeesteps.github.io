<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 24.8.1.2 (Linux)"/>
	<meta name="created" content="00:00:00"/>
	<meta name="changed" content="00:00:00"/>
	<style type="text/css">
		@page { size: 8.27in 11.69in; margin: 0.79in }
		p { line-height: 115%; margin-bottom: 0.1in; background: transparent }
		pre { background: transparent }
		pre.western { font-family: "Liberation Mono", monospace; font-size: 10pt }
		pre.cjk { font-family: "NSimSun", monospace; font-size: 10pt }
		pre.ctl { font-family: "Liberation Mono", monospace; font-size: 10pt }
	</style>
</head>
<body lang="en-US" link="#000080" vlink="#800000" dir="ltr"><pre class="western">import React, { useState, useEffect, useRef } from 'react';
import { 
  User, BookOpen, Heart, DollarSign, MapPin, 
  Clock, Activity, Users, Coffee, Bus, GraduationCap, 
  Briefcase, Smile, Frown, AlertTriangle, Cat, HeartHandshake,
  Ghost, Utensils, RotateCcw, Building
} from 'lucide-react';

// --- 1. Constants &amp; Game Data ---

// <font face="NSimSun, monospace"><span lang="zh-CN">è¿·å› é ­åƒ</span></font>
const AVATARS = [
  { id: 'smug', icon: 'ğŸ˜¼', name: '<font face="NSimSun, monospace"><span lang="zh-CN">è‡ªä¿¡</span></font>', desc: '<font face="NSimSun, monospace"><span lang="zh-CN">æˆ‘å°±ä¿‚è¦å±ˆæ©Ÿ</span></font>' },
  { id: 'crying', icon: 'ğŸ˜¿', name: '<font face="NSimSun, monospace"><span lang="zh-CN">å§”å±ˆ</span></font>', desc: 'GPA...<font face="NSimSun, monospace"><span lang="zh-CN">ä¸è¦å†è·Œäº†</span></font>' },
  { id: 'shocked', icon: 'ğŸ™€', name: '<font face="NSimSun, monospace"><span lang="zh-CN">é©šåš‡</span></font>', desc: 'Deadlines?!' },
  { id: 'love', icon: 'ğŸ˜»', name: '<font face="NSimSun, monospace"><span lang="zh-CN">æˆ€æ„›</span></font>', desc: '<font face="NSimSun, monospace"><span lang="zh-CN">æƒ³æ‹æ‹–</span></font>...' },
  { id: 'cool', icon: 'ğŸ˜', name: '<font face="NSimSun, monospace"><span lang="zh-CN">æˆ´è¶…</span></font>', desc: 'Soc<font face="NSimSun, monospace"><span lang="zh-CN">æˆ¿æˆ‘è©±äº‹</span></font>' },
  { id: 'sleepy', icon: 'ğŸ˜´', name: '<font face="NSimSun, monospace"><span lang="zh-CN">çœ¼ç“</span></font>', desc: '<font face="NSimSun, monospace"><span lang="zh-CN">æ—©å…«ä¸äº†</span></font>' },
  { id: 'clown', icon: 'ğŸ¤¡', name: '<font face="NSimSun, monospace"><span lang="zh-CN">å°ä¸‘</span></font>', desc: '<font face="NSimSun, monospace"><span lang="zh-CN">åˆæ˜¯ç•¶å°ä¸‘çš„ä¸€å¤©</span></font>' },
  { id: 'devil', icon: 'ğŸ˜ˆ', name: '<font face="NSimSun, monospace"><span lang="zh-CN">æƒ¡é­”</span></font>', desc: '<font face="NSimSun, monospace"><span lang="zh-CN">æˆ‘è¦ç©çˆ›å€‹</span></font>Grade' },
];

// <font face="NSimSun, monospace"><span lang="zh-CN">åˆå§‹äººéš›é—œä¿‚</span></font>
const INITIAL_RELATIONSHIPS = [
  { id: 'roommate', name: '<font face="NSimSun, monospace"><span lang="zh-CN">å¥½å¿ƒå®¿å‹</span></font>', level: 50, max: 100, desc: '<font face="NSimSun, monospace"><span lang="zh-CN">æœƒå¹«ä½ ç•™é–€çš„å¥½äºº</span></font>' },
  { id: 'prof', name: '<font face="NSimSun, monospace"><span lang="zh-CN">åš´å²æ•™æˆ</span></font>', level: 30, max: 100, desc: '<font face="NSimSun, monospace"><span lang="zh-CN">æŒæ¡ä½ </span></font>GPA<font face="NSimSun, monospace"><span lang="zh-CN">ç”Ÿæ®ºå¤§æ¬Š</span></font>' },
  { id: 'crush', name: '<font face="NSimSun, monospace"><span lang="zh-CN">å¿ƒå„€å°è±¡</span></font>', level: 10, max: 100, desc: '<font face="NSimSun, monospace"><span lang="zh-CN">å¯é è§€è€Œä¸å¯è¤»ç©</span></font>' },
  { id: 'canteen_lady', name: '<font face="NSimSun, monospace"><span lang="zh-CN">é£¯å ‚é˜¿å§</span></font>', level: 40, max: 100, desc: '<font face="NSimSun, monospace"><span lang="zh-CN">é—œä¿‚å¥½æœƒå¤šçµ¦ä½ å…©å¡Šè‚‰</span></font>' },
];

const FACULTIES = [
  { id: 'arts', name: '<font face="NSimSun, monospace"><span lang="zh-CN">æ–‡å­¸é™¢</span></font>', buff: 'social', description: '<font face="NSimSun, monospace"><span lang="zh-CN">æ°£è³ªå„ªé›…ï¼Œç¤¾äº¤</span></font>+10', initStats: { energy: 90, stress: 10, knowledge: 10, social: 40 } },
  { id: 'socsci', name: '<font face="NSimSun, monospace"><span lang="zh-CN">ç¤¾ç§‘é™¢</span></font>', buff: 'balanced', description: '<font face="NSimSun, monospace"><span lang="zh-CN">é—œå¿ƒç¤¾æœƒï¼Œå¹³å‡å‹</span></font>', initStats: { energy: 95, stress: 15, knowledge: 20, social: 30 } },
  { id: 'law', name: '<font face="NSimSun, monospace"><span lang="zh-CN">æ³•å¾‹å­¸é™¢</span></font>', buff: 'knowledge', description: '<font face="NSimSun, monospace"><span lang="zh-CN">é‚è¼¯ç¸å¯†ï¼ŒçŸ¥è­˜</span></font>+10', initStats: { energy: 85, stress: 30, knowledge: 40, social: 15 } },
  { id: 'edu', name: '<font face="NSimSun, monospace"><span lang="zh-CN">æ•™è‚²å­¸é™¢</span></font>', buff: 'stamina', description: '<font face="NSimSun, monospace"><span lang="zh-CN">å……æ»¿ç†±èª ï¼Œé«”åŠ›</span></font>+10', initStats: { energy: 100, stress: 10, knowledge: 20, social: 25 } },
  { id: 'sci', name: '<font face="NSimSun, monospace"><span lang="zh-CN">ç†å­¸é™¢</span></font>', buff: 'logic', description: '<font face="NSimSun, monospace"><span lang="zh-CN">æ¢ç´¢çœŸç†ï¼ŒçŸ¥è­˜é«˜</span></font>', initStats: { energy: 90, stress: 20, knowledge: 35, social: 10 } },
  { id: 'ba', name: '<font face="NSimSun, monospace"><span lang="zh-CN">å•†å­¸é™¢</span></font>', buff: 'money', description: '<font face="NSimSun, monospace"><span lang="zh-CN">å•†æ¥­é ­è…¦ï¼Œé‡‘éŒ¢</span></font>UP', initStats: { energy: 90, stress: 25, knowledge: 25, social: 35 } },
  { id: 'eng', name: '<font face="NSimSun, monospace"><span lang="zh-CN">å·¥ç¨‹å­¸é™¢</span></font>', buff: 'tech', description: '<font face="NSimSun, monospace"><span lang="zh-CN">çˆ†è‚å±¬æ€§ï¼Œé«”åŠ›ä¸Šé™é«˜</span></font>', initStats: { energy: 110, stress: 20, knowledge: 30, social: 5 } },
  { id: 'med', name: '<font face="NSimSun, monospace"><span lang="zh-CN">é†«å­¸é™¢</span></font>', buff: 'hardcore', description: '<font face="NSimSun, monospace"><span lang="zh-CN">ç²¾è‹±ä¸­çš„ç²¾è‹±ï¼Œæ¥µé«˜å£“</span></font>', initStats: { energy: 80, stress: 40, knowledge: 50, social: 10 } },
];

// <font face="NSimSun, monospace"><span lang="zh-CN">æ›´æ–°åœ°é»ï¼šæ–°å¢èª²å®¤ã€è¾¦å…¬å®¤ã€é£¯å ‚ï¼›ç§»é™¤æ–°äºã€è¯åˆ</span></font>
const LOCATIONS = [
  { id: 'dorm', name: '<font face="NSimSun, monospace"><span lang="zh-CN">å­¸ç”Ÿå®¿èˆ</span></font>', color: 'bg-orange-100', description: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ çš„æº«æš–å°çª©ï¼Œé©åˆä¼‘æ¯å’Œæ•´ç†å„€å®¹ã€‚</span></font>', actions: ['rest', 'play_game', 'chat_roommate'] },
  { id: 'mall', name: '<font face="NSimSun, monospace"><span lang="zh-CN">ç™¾è¬å¤§é“</span></font>', color: 'bg-gray-200', description: '<font face="NSimSun, monospace"><span lang="zh-CN">æ ¡åœ’å¿ƒè‡Ÿï¼Œ</span></font>Dem Beat <font face="NSimSun, monospace"><span lang="zh-CN">è–åœ°ã€‚</span></font>', actions: ['walk', 'dem_beat_practice', 'society_promotion'] },
  { id: 'library', name: '<font face="NSimSun, monospace"><span lang="zh-CN">å¤§å­¸åœ–æ›¸é¤¨</span></font>', color: 'bg-blue-100', description: '<font face="NSimSun, monospace"><span lang="zh-CN">é€²ä¿®è–åœ° </span></font>(UL)<font face="NSimSun, monospace"><span lang="zh-CN">ï¼Œè€ƒè©¦æœŸé–“å……æ»¿æ®ºæ°£ã€‚</span></font>', actions: ['study', 'research', 'sleep_library'] },
  { id: 'lake', name: '<font face="NSimSun, monospace"><span lang="zh-CN">æœªåœ“æ¹–</span></font>', color: 'bg-green-100', description: '<font face="NSimSun, monospace"><span lang="zh-CN">å´‡åŸºå­¸é™¢çš„ç¾éº—æ¹–ç•”ï¼Œé©åˆæ‹æ‹–ã€‚</span></font>', actions: ['date_walk', 'feed_birds', 'meditate'] }, 
  { id: 'station', name: '<font face="NSimSun, monospace"><span lang="zh-CN">å¤§å­¸ç«™</span></font>', color: 'bg-indigo-100', description: '<font face="NSimSun, monospace"><span lang="zh-CN">é€£æ¥ç¾å¯¦ä¸–ç•Œçš„å‡ºå£ã€‚</span></font>', actions: ['part_time', 'shop', 'slacking'] },
  // <font face="NSimSun, monospace"><span lang="zh-CN">æ–°å¢åœ°é»</span></font>
  { id: 'classroom', name: '<font face="NSimSun, monospace"><span lang="zh-CN">èª²å®¤</span></font>', color: 'bg-emerald-100', description: '<font face="NSimSun, monospace"><span lang="zh-CN">å­¸ç¿’èˆ‡è†è½æ•™æˆæ•™èª¨çš„åœ°æ–¹ã€‚</span></font>', actions: ['attend_class', 'sleep_class', 'social_group'] },
  { id: 'prof_office', name: '<font face="NSimSun, monospace"><span lang="zh-CN">æ•™æˆè¾¦å…¬å®¤</span></font>', color: 'bg-purple-100', description: '<font face="NSimSun, monospace"><span lang="zh-CN">é¼“èµ·å‹‡æ°£èˆ‡æ•™æˆé¢è«‡ï¼Œå°‹æ±‚æŒ‡å°ã€‚</span></font>', actions: ['ask_prof_guidance', 'submit_assignment'] },
  { id: 'canteen', name: '<font face="NSimSun, monospace"><span lang="zh-CN">é£¯å ‚ </span></font>(<font face="NSimSun, monospace"><span lang="zh-CN">çœ¾å¿—å ‚</span></font>)', color: 'bg-orange-200', description: '<font face="NSimSun, monospace"><span lang="zh-CN">è§£æ±ºæº«é£½å’Œèªè­˜æ–°æœ‹å‹çš„åœ°æ–¹ã€‚</span></font>', actions: ['eat_canteen', 'gossip', 'eat_expensive'] },
];

// <font face="NSimSun, monospace"><span lang="zh-CN">æ›´æ–°è¡Œå‹•è³‡æ–™åº«ï¼šæ–°å¢èª²ç¨‹ç›¸é—œè¡Œå‹•ï¼Œä¸¦èª¿æ•´éƒ¨åˆ†èˆŠè¡Œå‹•</span></font>
const ACTIONS_DB = {
  // <font face="NSimSun, monospace"><span lang="zh-CN">åŸºç¤ç”Ÿå­˜</span></font>
  rest: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">ç¡è¦ºè£œçœ </span></font>', energy: 40, stress: -20, knowledge: 0, social: 0, money: 0, time: 3, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ åœ¨åºŠä¸Šç¡å¾—å¾ˆé¦™ï¼Œç²¾ç¥é£½æ»¿ï¼</span></font>' },
  play_game: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">é€šå®µæ‰“æ©Ÿ</span></font>', energy: -10, stress: -20, knowledge: -2, social: 5, money: 0, time: 4, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">é›–ç„¶é»‘çœ¼åœˆåŠ æ·±äº†ï¼Œä½†å¿ƒæƒ…èˆ’æš¢ã€‚</span></font>' },
  
  // <font face="NSimSun, monospace"><span lang="zh-CN">ç¤¾äº¤èˆ‡äººéš›</span></font>
  chat_roommate: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">èˆ‡å®¿å‹å®µå¤œ</span></font>', energy: 10, stress: -10, knowledge: 0, social: 10, money: -40, time: 2, npc: 'roommate', npcVal: 10, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ å€‘èŠäº†å¾ˆå¤šå…«å¦ï¼Œå®¿å‹å°ä½ å¥½æ„Ÿåº¦ä¸Šå‡ã€‚</span></font>' },
  society_promotion: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">ä¸ŠèŠå®£å‚³</span></font>', energy: -20, stress: 10, knowledge: 0, social: 20, money: 0, time: 3, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ å¤§å–Šå£è™Ÿæ‹‰äººå…¥æœƒï¼Œå–‰åš¨éƒ½å•äº†ã€‚</span></font>' },
  date_walk: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">æ¹–é‚Šæ•£æ­¥</span></font>', energy: -10, stress: -15, knowledge: 0, social: 15, money: 0, time: 2, npc: 'crush', npcVal: 15, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">æ°£æ°›ä¸éŒ¯ï¼Œé€™å°±æ˜¯é’æ˜¥å—ï¼Ÿ</span></font>(<font face="NSimSun, monospace"><span lang="zh-CN">å¿ƒå„€å°è±¡å¥½æ„Ÿ</span></font>UP)' },
  
  // <font face="NSimSun, monospace"><span lang="zh-CN">å­¸æ¥­</span></font>
  study: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">æº«ç¿’ç­†è¨˜</span></font>', energy: -15, stress: 10, knowledge: 15, social: -5, money: 0, time: 2, npc: 'prof', npcVal: 2, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ æ„Ÿåˆ°çŸ¥è­˜é€šéçœ¼ç›é€²å…¥äº†å¤§è…¦ã€‚</span></font>' },
  research: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">è¶• </span></font>Paper', energy: -25, stress: 25, knowledge: 25, social: -10, money: 0, time: 3, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">æ­»ç·šæˆ°å£«å‡ºå‹•ï¼</span></font>' },
  sleep_library: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">åœ–æ›¸é¤¨è£œçœ </span></font>', energy: 15, stress: -5, knowledge: 2, social: -2, money: 0, time: 1, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">è¶´åœ¨æ›¸ä¸Šç¡ç‰¹åˆ¥é¦™ï¼Œé‚„å¸æ”¶äº†æ›¸æœ¬çš„ç²¾è¯ï¼Ÿ</span></font>' },
  
  // <font face="NSimSun, monospace"><span lang="zh-CN">ç‰¹æ®Šèˆ‡ä¼‘é–’</span></font>
  dem_beat_practice: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">ç·´ç¿’ </span></font>Dem Beat', energy: -20, stress: 5, knowledge: 0, social: 15, money: 0, time: 2, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">æç›¡ç„¡æ‚”ï¼å±±åŸç²¾ç¥ï¼</span></font>' },
  meditate: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">åœ¨æ¹–é‚Šæ²‰æ€</span></font>', energy: 5, stress: -30, knowledge: 5, social: 0, money: 0, time: 1, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ åœ¨æ¹–ç•”çš„é•·æ¤…ä¸Šæ²‰æ€ï¼Œå…§å¿ƒå¹³éœã€‚</span></font>' }, // <font face="NSimSun, monospace"><span lang="zh-CN">èª¿æ•´æè¿°</span></font>
  
  // <font face="NSimSun, monospace"><span lang="zh-CN">å…¼è·èˆ‡æ¶ˆè²»</span></font>
  shop: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">è¶…å¸‚å…¥è²¨</span></font>', energy: 5, stress: -5, knowledge: 0, social: 0, money: -80, time: 1, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">è²·äº†ä¸€å †é›¶é£Ÿå’Œæ¯éºµã€‚</span></font>' },
  part_time: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">å…¼è·è£œç¿’</span></font>', energy: -25, stress: 15, knowledge: 2, social: 0, money: 250, time: 3, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">æ•™å°å­¸ç”ŸåšåŠŸèª²ï¼Œè³ºå¾—ç›†æ»¿ç¼½æ»¿ã€‚</span></font>' },
  
  // <font face="NSimSun, monospace"><span lang="zh-CN">å…¶ä»–</span></font>
  walk: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">æ•£æ­¥</span></font>', energy: -5, stress: -5, knowledge: 0, social: 0, money: 0, time: 1, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">èµ°èµ°é€›é€›ã€‚</span></font>' },
  slacking: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">ç¿¹èª²</span></font>', energy: 10, stress: -10, knowledge: -5, social: 5, money: 0, time: 2, npc: 'prof', npcVal: -10, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">å·å¾—æµ®ç”ŸåŠæ—¥é–’ï¼Œä½†æ•™æˆå¥½åƒè¨˜ä½äº†ä½ çš„åå­—</span></font>...' },
  feed_birds: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">é¤µé›€</span></font>', energy: -5, stress: -10, knowledge: 2, social: 0, money: -10, time: 1, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">æœªåœ“æ¹–çš„é³¥éƒ½è¢«ä½ é¤µèƒ–äº†ã€‚</span></font>' },

  // <font face="NSimSun, monospace"><span lang="zh-CN">é£¯å ‚è¡Œå‹•</span></font>
  eat_canteen: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">åƒé ¹é£¯</span></font>', energy: 25, stress: 5, knowledge: 0, social: 0, money: -25, time: 1, npc: 'canteen_lady', npcVal: 5, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">é˜¿å§ä»Šå¤©å¿ƒæƒ…å¥½ï¼Œå¤šçµ¦äº†ä½ ä¸€æ¢èœã€‚</span></font>' },
  gossip: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">å…«å¦æ˜¯é</span></font>', energy: -5, stress: -10, knowledge: 0, social: 10, money: 0, time: 1, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ å’Œæœ‹å‹äº¤æ›äº†æœ€æ–°çš„æ ¡åœ’å…«å¦ï¼Œå¿ƒæƒ…èˆ’æš¢ã€‚</span></font>' },
  eat_expensive: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">é£Ÿå¥½å•² </span></font>(<font face="NSimSun, monospace"><span lang="zh-CN">çŠ’å‹è‡ªå·±</span></font>)', energy: 35, stress: -15, knowledge: 0, social: 5, money: -120, time: 1, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">å¥¢ä¾ˆäº†ä¸€é “ï¼Œå¿ƒæƒ…å’Œé«”åŠ›éƒ½å¤§å¤§æå‡ï¼</span></font>' },

  // <font face="NSimSun, monospace"><span lang="zh-CN">èª²å®¤è¡Œå‹•</span></font>
  attend_class: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">ä¸Šèª²è½è¬›</span></font>', energy: -15, stress: 5, knowledge: 10, social: 0, money: 0, time: 2, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">é›–ç„¶å·®é»ç¡è‘—ï¼Œä½†è‡³å°‘è½æ‡‚äº†å¹¾å€‹æ¦‚å¿µã€‚</span></font>' },
  sleep_class: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">èª²å ‚è£œçœ </span></font>', energy: 20, stress: -5, knowledge: -5, social: 0, money: 0, time: 2, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ æŠŠæ›¸ç«‹èµ·ä¾†å·å·ç¡äº†ä¸€è¦ºï¼Œç²¾ç¥å¥½äº†ï¼Œä½†éŒ¯éäº†é‡é»ã€‚</span></font>' },
  social_group: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">å°çµ„è¨è«–</span></font>', energy: -10, stress: 10, knowledge: 5, social: 10, money: 0, time: 2, npc: 'roommate', npcVal: 5, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ å€‘åœ¨è¨è«–ä¸­æ‰¾åˆ°äº†å…±è­˜ï¼Œå°çµ„é—œä¿‚æ›´å¥½äº†ã€‚</span></font>' },

  // <font face="NSimSun, monospace"><span lang="zh-CN">æ•™æˆè¾¦å…¬å®¤è¡Œå‹•</span></font>
  ask_prof_guidance: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">è«‹æ•™æ•™æˆ</span></font>', energy: -10, stress: 15, knowledge: 20, social: 0, money: 0, time: 1, npc: 'prof', npcVal: 10, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">é›–ç„¶æœ‰é»ç·Šå¼µï¼Œä½†æ•™æˆçµ¦ä½ æŒ‡é»è¿·æ´¥ï¼ŒçŸ¥è­˜å¤§å¢ï¼</span></font>' },
  submit_assignment: { label: '<font face="NSimSun, monospace"><span lang="zh-CN">æäº¤åŠŸèª²</span></font>', energy: -5, stress: -25, knowledge: 5, social: 0, money: 0, time: 0, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">æŠŠæ–‡ä»¶å¤¾æŠ•é€²äº†æ•™æˆçš„ä¿¡ç®±ï¼Œå£“åŠ›ä¸€æƒè€Œç©ºï¼</span></font>' },
};

// --- Components ---

export default function CUHKSimsLife() {
  // Game State
  const [screen, setScreen] = useState('intro'); 
  const [player, setPlayer] = useState({ name: '', faculty: 'arts', avatar: 'smug' });
  const [stats, setStats] = useState({ energy: 100, stress: 0, knowledge: 0, social: 0, money: 0 });
  const [relationships, setRelationships] = useState(INITIAL_RELATIONSHIPS);
  const [time, setTime] = useState({ day: 1, hour: 9 }); 
  const [location, setLocation] = useState('dorm');
  const [logs, setLogs] = useState([]);
  const [popup, setPopup] = useState(null); 

  const logsEndRef = useRef(null);

  useEffect(() =&gt; {
    logsEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [logs]);

  // Initial Money Randomizer
  const generateMoney = (facultyId) =&gt; {
    let base = Math.floor(Math.random() * 500) + 800; 
    if (facultyId === 'ba') base += 800;
    if (facultyId === 'arts') base -= 100;
    return base;
  };

  const startGame = () =&gt; {
    const facultyData = FACULTIES.find(f =&gt; f.id === player.faculty);
    setStats({
      ...facultyData.initStats,
      money: generateMoney(player.faculty)
    });
    setLogs([`<font face="NSimSun, monospace"><span lang="zh-CN">æ­¡è¿ä¾†åˆ° </span></font>CUHK<font face="NSimSun, monospace"><span lang="zh-CN">ï¼ä½ æ˜¯</span></font>${facultyData.name}<font face="NSimSun, monospace"><span lang="zh-CN">çš„æ–°ç”Ÿã€‚å¥½å¥½è¦åŠƒä½ çš„å¤§å­¸ç”Ÿæ´»å§ï¼</span></font>`]);
    setScreen('game');
  };

  // <font face="NSimSun, monospace"><span lang="zh-CN">é‡ç½®éŠæˆ²åŠŸèƒ½</span></font>
  const resetGame = () =&gt; {
    setScreen('intro');
    setPlayer({ name: '', faculty: 'arts', avatar: 'smug' });
    setStats({ energy: 100, stress: 0, knowledge: 0, social: 0, money: 0 });
    setRelationships(INITIAL_RELATIONSHIPS);
    setTime({ day: 1, hour: 9 });
    setLogs([]);
    setLocation('dorm');
    setPopup(null);
  };

  // Helper
  const formatTime = (h) =&gt; {
    const period = h &gt;= 12 ? 'PM' : 'AM';
    const displayH = h &gt; 12 ? h - 12 : h;
    return `${displayH}:00 ${period}`;
  };

  const addLog = (msg) =&gt; {
    setLogs(prev =&gt; [...prev, `[D${time.day} ${formatTime(time.hour)}] ${msg}`]);
  };

  // Relationship Helper
  const updateRelationship = (npcId, value) =&gt; {
    if (!npcId) return;
    setRelationships(prev =&gt; prev.map(r =&gt; {
      if (r.id === npcId) {
        const newVal = Math.min(r.max, Math.max(0, r.level + value));
        let changeMsg = '';
        if (value &gt; 0) changeMsg = ` (${r.name} <font face="NSimSun, monospace"><span lang="zh-CN">å¥½æ„Ÿ </span></font>+${value})`;
        else if (value &lt; 0) changeMsg = ` (${r.name} <font face="NSimSun, monospace"><span lang="zh-CN">å¥½æ„Ÿ </span></font>${value})`;
        if (changeMsg) addLog(changeMsg);
        return { ...r, level: newVal };
      }
      return r;
    }));
  };

  const triggerRandomEvent = () =&gt; {
    const chance = Math.random();
    if (chance &gt; 0.35) return; 

    const events = [
      { 
        title: '<font face="NSimSun, monospace"><span lang="zh-CN">çªç™¼ </span></font>Dem Beat!', 
        icon: &lt;Users size={32} /&gt;,
        desc: '<font face="NSimSun, monospace"><span lang="zh-CN">è·¯éç™¾è¬å¤§é“ï¼Œçªç„¶è¢«ä¸€ç­ç©¿è‘—ç³»</span></font>Tee<font face="NSimSun, monospace"><span lang="zh-CN">çš„äººåœä½å¤§å«å£è™Ÿï¼</span></font>',
        choices: [
          { text: '<font face="NSimSun, monospace"><span lang="zh-CN">ä¸€èµ·å«ï¼</span></font>', effect: { social: 15, stress: 5, energy: -10 }, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ å¤§å«ã€Œé»‘å¤§é»‘å¤§ä¸­å¤§ï¼ã€ï¼Œé›–ç„¶å¾ˆç´¯ä½†å¾ˆçˆ½ã€‚</span></font>' },
          { text: '<font face="NSimSun, monospace"><span lang="zh-CN">å°·å°¬é€ƒè·‘</span></font>', effect: { social: -5, stress: 10 }, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ ä½é ­å¿«é€Ÿèµ°éï¼Œè¦ºå¾—ç¤¾æç™¼ä½œã€‚</span></font>' }
        ]
      },
      { 
        title: '<font face="NSimSun, monospace"><span lang="zh-CN">çŒ´å­æ¶åŠ«</span></font>', 
        icon: &lt;Ghost size={32} /&gt;,
        desc: '<font face="NSimSun, monospace"><span lang="zh-CN">ä¸€éš»å…‡çŒ›çš„çŒ´å­ç›¯ä¸Šäº†ä½ æ‰‹ä¸­çš„ä¸‰æ–‡æ²»ï¼</span></font>',
        choices: [
          { text: '<font face="NSimSun, monospace"><span lang="zh-CN">æ£„é£Ÿä¿å‘½</span></font>', effect: { money: -20, energy: -10 }, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">çŒ´å­æ‹¿èµ°äº†é£Ÿç‰©ï¼Œä½ é¤“è‘—è‚šå­é›¢é–‹äº†ã€‚</span></font>' },
          { text: '<font face="NSimSun, monospace"><span lang="zh-CN">èˆ‡çŒ´å­æ±ºé¬¥</span></font>', effect: { stress: 20, energy: -15 }, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ æˆåŠŸåš‡é€€äº†çŒ´å­ï¼Œä½†å·®é»è¢«æŠ“å‚·ã€‚</span></font>' }
        ]
      },
      { 
        title: '<font face="NSimSun, monospace"><span lang="zh-CN">æ ¡å·´æ»¿åº§</span></font>', 
        icon: &lt;Bus size={32} /&gt;,
        desc: '<font face="NSimSun, monospace"><span lang="zh-CN">è½‰å ‚æ™‚é–“ï¼Œæ ¡å·´ç«™æ’äº†é•·é•·çš„äººé¾ã€‚</span></font>',
        choices: [
          { text: '<font face="NSimSun, monospace"><span lang="zh-CN">è¡Œè·¯ä¸Šå±±</span></font>', effect: { energy: -20, stress: 5 }, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ çˆ¬å¡çˆ¬åˆ°æ‡·ç–‘äººç”Ÿï¼Œé€™å°±æ˜¯ã€Œä¸­å¤§å±±åŸã€ï¼</span></font>' },
          { text: '<font face="NSimSun, monospace"><span lang="zh-CN">ç­‰ä¸‹ä¸€ç­</span></font>', effect: { time: 1, stress: -5 }, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ æ±ºå®šæ…¢æ…¢ç­‰ï¼Œé›–ç„¶é²åˆ°äº†ï¼Œä½†å¿ƒæƒ…å¹³éœã€‚</span></font>' }
        ]
      },
      {
        title: 'Add Drop <font face="NSimSun, monospace"><span lang="zh-CN">æˆ°çˆ­</span></font>',
        icon: &lt;Activity size={32} /&gt;,
        desc: '<font face="NSimSun, monospace"><span lang="zh-CN">ä»Šå¤©æ˜¯ </span></font>Add Drop <font face="NSimSun, monospace"><span lang="zh-CN">æœ€å¾Œä¸€å¤©ï¼Œç³»çµ±éå¸¸å¡ï¼</span></font>',
        choices: [
          { text: '<font face="NSimSun, monospace"><span lang="zh-CN">ç˜‹ç‹‚ </span></font>F5', effect: { stress: 15, knowledge: 5 }, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ çµ‚æ–¼æ¶åˆ°äº†å¿ƒå„€çš„é€šè­˜èª² </span></font>(GE)<font face="NSimSun, monospace"><span lang="zh-CN">ï¼</span></font>' },
          { text: '<font face="NSimSun, monospace"><span lang="zh-CN">éš¨ç·£å§</span></font>', effect: { stress: -5 }, msg: '<font face="NSimSun, monospace"><span lang="zh-CN">ä½ æ”¾æ£„äº†æ™æ‰ï¼Œé¸äº†å‰©ä¸‹çš„èª²ã€‚</span></font>' }
        ]
      }
    ];

    const randomEvent = events[Math.floor(Math.random() * events.length)];
    setPopup(randomEvent);
  };

  const handleAction = (actionKey) =&gt; {
    const action = ACTIONS_DB[actionKey];
    
    // 1. <font face="NSimSun, monospace"><span lang="zh-CN">æª¢æŸ¥é‡‘éŒ¢</span></font>
    if (stats.money + action.money &lt; 0) {
      addLog('<font face="NSimSun, monospace"><span lang="zh-CN">ä½ çš„éŒ¢ä¸å¤ äº†ï¼é€™å°±æ˜¯è²§çª®å¤§å­¸ç”Ÿçš„æ‚²å“€</span></font>...');
      return;
    }
    
    // 2. <font face="NSimSun, monospace"><span lang="zh-CN">æª¢æŸ¥é«”åŠ›ä¸¦åˆ¤æ–·æ˜¯å¦ </span></font>Game Over
    const newEnergy = stats.energy + action.energy;
    if (newEnergy &lt;= 0) {
      // <font face="NSimSun, monospace"><span lang="zh-CN">ä»ç„¶æ‡‰ç”¨å…¶ä»–ç‹€æ…‹çš„è®ŠåŒ–ï¼Œä½†é«”åŠ›æ­¸é›¶æˆ–è² æ•¸</span></font>
      setStats(prev =&gt; ({
          energy: Math.min(120, Math.max(0, newEnergy)), 
          stress: Math.max(0, prev.stress + action.stress),
          knowledge: Math.min(100, prev.knowledge + action.knowledge),
          social: Math.min(100, prev.social + action.social),
          money: prev.money + action.money
      }));
      addLog(`ğŸš¨ <font face="NSimSun, monospace"><span lang="zh-CN">é«”åŠ›å®Œå…¨é€æ”¯ </span></font>(${action.energy &gt; 0 ? '+' : ''}${action.energy})<font face="NSimSun, monospace"><span lang="zh-CN">ï¼Œä½ å€’ä¸‹äº†ï¼</span></font>`);
      setScreen('gameover');
      return;
    }

    // 3. <font face="NSimSun, monospace"><span lang="zh-CN">æ‡‰ç”¨æ‰€æœ‰ç‹€æ…‹çš„è®ŠåŒ–</span></font>
    setStats(prev =&gt; ({
      energy: Math.min(120, Math.max(0, newEnergy)),
      stress: Math.max(0, prev.stress + action.stress),
      knowledge: Math.min(100, prev.knowledge + action.knowledge),
      social: Math.min(100, prev.social + action.social),
      money: prev.money + action.money
    }));

    if (action.npc) {
      updateRelationship(action.npc, action.npcVal);
    }

    let newHour = time.hour + action.time;
    let newDay = time.day;
    
    addLog(action.msg);

    // <font face="NSimSun, monospace"><span lang="zh-CN">è™•ç†æ™‚é–“è·³è½‰</span></font>
    if (newHour &gt;= 24) {
      newHour = 9; 
      newDay += 1;
      addLog('=== <font face="NSimSun, monospace"><span lang="zh-CN">ç†¬å¤œä¸å¥½å–”ï¼Œæ–°çš„ä¸€å¤©é–‹å§‹ï¼ </span></font>===');
      // <font face="NSimSun, monospace"><span lang="zh-CN">è¼•å¾®æ¢å¾©é«”åŠ›å’Œæ¸›å£“</span></font>
      setStats(prev =&gt; ({ ...prev, energy: Math.min(120, prev.energy + 40), stress: Math.max(0, prev.stress - 15) }));
    }

    setTime({ day: newDay, hour: newHour });

    triggerRandomEvent();
  };

  const handleMove = (locId) =&gt; {
    if (locId === location) return;
    
    const costEnergy = 5;
    const costTime = 1;

    if (stats.energy &lt; costEnergy) {
      addLog('<font face="NSimSun, monospace"><span lang="zh-CN">å¤ªç´¯äº†ï¼Œèµ°ä¸å‹•ï¼Œç§»å‹•å¤±æ•—</span></font>...');
      return;
    }

    setStats(prev =&gt; ({ ...prev, energy: prev.energy - costEnergy }));
    
    let newHour = time.hour + costTime;
    let newDay = time.day;

    if (newHour &gt;= 24) {
        newHour = 9; 
        newDay += 1;
        addLog('<font face="NSimSun, monospace"><span lang="zh-CN">è¡Œè·¯è¡Œåˆ°å¤©å…‰</span></font>... (<font face="NSimSun, monospace"><span lang="zh-CN">é«”åŠ›æ¢å¾©å°‘è¨±</span></font>)');
        setStats(prev =&gt; ({ ...prev, energy: prev.energy + 20 }));
    } 

    setTime({ day: newDay, hour: newHour });
    setLocation(locId);
    addLog(`<font face="NSimSun, monospace"><span lang="zh-CN">ç§»å‹•åˆ°äº† </span></font>${LOCATIONS.find(l =&gt; l.id === locId).name}<font face="NSimSun, monospace"><span lang="zh-CN">ã€‚</span></font>`);
    triggerRandomEvent();
  };

  const handleEventChoice = (choice) =&gt; {
    // <font face="NSimSun, monospace"><span lang="zh-CN">æª¢æŸ¥äº‹ä»¶é¸æ“‡æœƒå¦å°è‡´ </span></font>Game Over
    const newEnergy = stats.energy + (choice.effect.energy || 0);
    if (newEnergy &lt;= 0) {
      // <font face="NSimSun, monospace"><span lang="zh-CN">é«”åŠ›é€æ”¯</span></font>
       setStats(prev =&gt; ({
          energy: 0, 
          stress: prev.stress + (choice.effect.stress || 0),
          knowledge: prev.knowledge + (choice.effect.knowledge || 0),
          social: prev.social + (choice.effect.social || 0),
          money: prev.money + (choice.effect.money || 0)
      }));
      addLog(`ğŸš¨ <font face="NSimSun, monospace"><span lang="zh-CN">äº‹ä»¶çµæœå°è‡´é«”åŠ›é€æ”¯ï¼ŒéŠæˆ²çµæŸï¼</span></font>`);
      setPopup(null);
      setScreen('gameover');
      return;
    }
    
    setStats(prev =&gt; ({
      energy: Math.min(120, Math.max(0, newEnergy)),
      stress: prev.stress + (choice.effect.stress || 0),
      knowledge: prev.knowledge + (choice.effect.knowledge || 0),
      social: prev.social + (choice.effect.social || 0),
      money: prev.money + (choice.effect.money || 0),
    }));
    
    if (choice.effect.time) {
        let newHour = time.hour + choice.effect.time;
         if (newHour &gt;= 24) {
            newHour = 9; 
            setTime(prev =&gt; ({ day: prev.day + 1, hour: newHour }));
        } else {
            setTime(prev =&gt; ({ ...prev, hour: newHour }));
        }
    }

    addLog(choice.msg);
    setPopup(null);
  };

  // --- Screens ---

  // 1. Intro Screen
  if (screen === 'intro') {
    return (
      &lt;div className=&quot;min-h-screen bg-indigo-900 flex flex-col items-center justify-center text-white p-6 font-sans relative overflow-hidden&quot;&gt;
        &lt;div className=&quot;absolute top-10 right-10 opacity-20&quot;&gt;&lt;Building size={120} /&gt;&lt;/div&gt;
        &lt;div className=&quot;absolute bottom-10 left-10 opacity-20&quot;&gt;&lt;GraduationCap size={120} /&gt;&lt;/div&gt;
        
        &lt;div className=&quot;bg-white/10 backdrop-blur-md p-8 rounded-3xl shadow-2xl border border-white/20 text-center max-w-lg animate-fade-in-up&quot;&gt;
          &lt;div className=&quot;flex justify-center mb-4 text-yellow-300&quot;&gt;
             &lt;GraduationCap size={64} className=&quot;animate-bounce&quot; /&gt;
          &lt;/div&gt;
          &lt;h1 className=&quot;text-5xl font-black mb-2 tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-pink-300&quot;&gt;
            <font face="NSimSun, monospace"><span lang="zh-CN">ä¸­å¤§æ¨¡æ“¬äººç”Ÿ</span></font>
          &lt;/h1&gt;
          &lt;h2 className=&quot;text-2xl font-bold text-indigo-200 mb-6&quot;&gt;<font face="NSimSun, monospace"><span lang="zh-CN">å¤§å­¸ç”Ÿæ´»é«”é©—ç‰ˆ</span></font>&lt;/h2&gt;
          
          &lt;p className=&quot;text-indigo-100 mb-8 leading-relaxed&quot;&gt;
            <font face="NSimSun, monospace"><span lang="zh-CN">æ­¡è¿ä¾†åˆ°å±±åŸï¼åŒ–èº«ç‚ºå¤§å­¸ç”Ÿï¼Œ</span></font>
            <font face="NSimSun, monospace"><span lang="zh-CN">åœ¨ç™¾è¬å¤§é“æ‰“å¡ï¼Œåœ¨åœ–æ›¸é¤¨è¶• </span></font>Due<font face="NSimSun, monospace"><span lang="zh-CN">ï¼Œ</span></font>
            <font face="NSimSun, monospace"><span lang="zh-CN">é‚„è¦å°å¿ƒä¸è¦è¢«çŒ´å­æ¶èµ°åˆé¤ï¼</span></font>
          &lt;/p&gt;
          
          &lt;button 
            onClick={() =&gt; setScreen('create')}
            className=&quot;w-full bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white font-black py-4 px-8 rounded-2xl shadow-lg transition transform hover:scale-105 hover:shadow-xl flex items-center justify-center gap-2&quot;
          &gt;
            &lt;Smile size={24} /&gt; <font face="NSimSun, monospace"><span lang="zh-CN">é–‹å§‹å…¥å­¸</span></font>
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }

  // 2. Character Creation
  if (screen === 'create') {
    return (
      &lt;div className=&quot;min-h-screen bg-indigo-50 flex items-center justify-center p-4 font-sans&quot;&gt;
        &lt;div className=&quot;bg-white p-6 md:p-8 rounded-3xl shadow-xl w-full max-w-4xl flex flex-col md:flex-row gap-8&quot;&gt;
          
          {/* Left: Input &amp; Avatar */}
          &lt;div className=&quot;flex-1 space-y-6&quot;&gt;
            &lt;h2 className=&quot;text-3xl font-black text-indigo-900&quot;&gt;<font face="NSimSun, monospace"><span lang="zh-CN">å…¥å­¸è¨»å†Š ğŸ“</span></font>&lt;/h2&gt;
            
            &lt;div&gt;
              &lt;label className=&quot;block text-gray-700 font-bold mb-2&quot;&gt;<font face="NSimSun, monospace"><span lang="zh-CN">ä½ çš„åå­—</span></font>&lt;/label&gt;
              &lt;input 
                type=&quot;text&quot; 
                className=&quot;w-full bg-gray-50 border-2 border-gray-200 p-3 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition text-lg&quot;
                value={player.name}
                onChange={(e) =&gt; setPlayer({...player, name: e.target.value})}
                placeholder=&quot;<font face="NSimSun, monospace"><span lang="zh-CN">è¼¸å…¥åå­—</span></font>&quot;
              /&gt;
            &lt;/div&gt;

            &lt;div&gt;
              &lt;label className=&quot;block text-gray-700 font-bold mb-3&quot;&gt;<font face="NSimSun, monospace"><span lang="zh-CN">é¸æ“‡ä½ çš„å¿ƒæƒ…é ­åƒ</span></font>&lt;/label&gt;
              &lt;div className=&quot;grid grid-cols-4 gap-2&quot;&gt;
                {AVATARS.map(avatar =&gt; (
                  &lt;button
                    key={avatar.id}
                    onClick={() =&gt; setPlayer({...player, avatar: avatar.id})}
                    className={`aspect-square rounded-2xl border-2 flex flex-col items-center justify-center transition relative overflow-hidden ${
                      player.avatar === avatar.id 
                        ? 'border-indigo-500 bg-indigo-50 shadow-inner' 
                        : 'border-gray-200 hover:border-indigo-300 hover:bg-white'
                    }`}
                  &gt;
                    &lt;span className=&quot;text-3xl mb-1&quot;&gt;{avatar.icon}&lt;/span&gt;
                    &lt;span className=&quot;text-[10px] font-bold text-gray-600 text-center leading-tight px-1&quot;&gt;{avatar.name}&lt;/span&gt;
                    {player.avatar === avatar.id &amp;&amp; (
                        &lt;div className=&quot;absolute top-1 right-1 w-2 h-2 bg-indigo-500 rounded-full&quot;&gt;&lt;/div&gt;
                    )}
                  &lt;/button&gt;
                ))}
              &lt;/div&gt;
              &lt;p className=&quot;text-xs text-gray-500 mt-2 text-center bg-gray-100 p-2 rounded-lg&quot;&gt;
                {AVATARS.find(a =&gt; a.id === player.avatar)?.desc}
              &lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          {/* Right: Faculty Selection */}
          &lt;div className=&quot;flex-1 flex flex-col&quot;&gt;
            &lt;label className=&quot;block text-gray-700 font-bold mb-3&quot;&gt;<font face="NSimSun, monospace"><span lang="zh-CN">é¸æ“‡å­¸é™¢</span></font>&lt;/label&gt;
            &lt;div className=&quot;grid grid-cols-1 gap-2 overflow-y-auto max-h-[400px] pr-2 custom-scrollbar flex-1&quot;&gt;
              {FACULTIES.map(f =&gt; (
                &lt;button
                  key={f.id}
                  onClick={() =&gt; setPlayer({...player, faculty: f.id})}
                  className={`p-4 rounded-xl border-2 text-left transition flex items-start gap-3 ${
                    player.faculty === f.id 
                      ? 'border-indigo-500 bg-indigo-50' 
                      : 'border-gray-100 hover:border-indigo-200 bg-white'
                  }`}
                &gt;
                  &lt;div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${player.faculty === f.id ? 'bg-indigo-200 text-indigo-700' : 'bg-gray-100 text-gray-400'}`}&gt;
                    &lt;GraduationCap size={20} /&gt;
                  &lt;/div&gt;
                  &lt;div&gt;
                    &lt;div className=&quot;font-bold text-gray-800 text-lg&quot;&gt;{f.name}&lt;/div&gt;
                    &lt;div className=&quot;text-xs text-gray-500 font-medium&quot;&gt;{f.description}&lt;/div&gt;
                  &lt;/div&gt;
                &lt;/button&gt;
              ))}
            &lt;/div&gt;
            
            &lt;button 
              disabled={!player.name}
              onClick={startGame}
              className={`mt-6 w-full font-bold py-4 rounded-2xl shadow-lg transition transform active:scale-95 ${
                player.name 
                  ? 'bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-xl' 
                  : 'bg-gray-300 text-gray-500 cursor-not-allowed'
              }`}
            &gt;
              <font face="NSimSun, monospace"><span lang="zh-CN">ç¢ºèªå…¥å­¸ â†’</span></font>
            &lt;/button&gt;
          &lt;/div&gt;

        &lt;/div&gt;
      &lt;/div&gt;
    );
  }

  // 3. Game Over Screen
  if (screen === 'gameover') {
    return (
      &lt;div className=&quot;min-h-screen bg-gray-900 flex flex-col items-center justify-center text-white p-6 font-sans&quot;&gt;
        &lt;div className=&quot;bg-gray-800 p-8 rounded-3xl shadow-2xl max-w-md w-full text-center border border-gray-700&quot;&gt;
            &lt;div className=&quot;mb-6 animate-pulse&quot;&gt;
                &lt;span className=&quot;text-6xl&quot;&gt;ğŸ’€&lt;/span&gt;
            &lt;/div&gt;
            &lt;h1 className=&quot;text-3xl font-black mb-2 text-red-400&quot;&gt;<font face="NSimSun, monospace"><span lang="zh-CN">é«”åŠ›é€æ”¯ </span></font>(Game Over)&lt;/h1&gt;
            &lt;p className=&quot;text-gray-300 mb-8&quot;&gt;
            <font face="NSimSun, monospace"><span lang="zh-CN">ä½ åœ¨å›å®¿èˆçš„æ–œå¡ä¸Šå€’ä¸‹äº†</span></font>...&lt;br/&gt;
            <font face="NSimSun, monospace"><span lang="zh-CN">è¢«å¥½å¿ƒçš„å®¿å‹æŠ¬é€²äº†æ•‘è­·è»Šã€‚</span></font>
            &lt;/p&gt;
            
            &lt;div className=&quot;bg-gray-900/50 p-4 rounded-2xl mb-8 text-left space-y-2&quot;&gt;
            &lt;h3 className=&quot;font-bold text-gray-400 text-xs uppercase tracking-wider mb-2&quot;&gt;<font face="NSimSun, monospace"><span lang="zh-CN">ä½ çš„æˆç¸¾å–®</span></font>&lt;/h3&gt;
            &lt;div className=&quot;flex justify-between&quot;&gt;&lt;span&gt;<font face="NSimSun, monospace"><span lang="zh-CN">å­˜æ´»å¤©æ•¸</span></font>&lt;/span&gt; &lt;span className=&quot;font-mono text-yellow-400&quot;&gt;{time.day} <font face="NSimSun, monospace"><span lang="zh-CN">å¤©</span></font>&lt;/span&gt;&lt;/div&gt;
            &lt;div className=&quot;flex justify-between&quot;&gt;&lt;span&gt;<font face="NSimSun, monospace"><span lang="zh-CN">çŸ¥è­˜ç©ç´¯</span></font>&lt;/span&gt; &lt;span className=&quot;font-mono text-blue-400&quot;&gt;{stats.knowledge}&lt;/span&gt;&lt;/div&gt;
            &lt;div className=&quot;flex justify-between&quot;&gt;&lt;span&gt;<font face="NSimSun, monospace"><span lang="zh-CN">ç¤¾äº¤æŒ‡æ•¸</span></font>&lt;/span&gt; &lt;span className=&quot;font-mono text-pink-400&quot;&gt;{stats.social}&lt;/span&gt;&lt;/div&gt;
            &lt;div className=&quot;flex justify-between&quot;&gt;&lt;span&gt;<font face="NSimSun, monospace"><span lang="zh-CN">å‰©é¤˜ç§æˆ¿éŒ¢</span></font>&lt;/span&gt; &lt;span className=&quot;font-mono text-green-400&quot;&gt;${stats.money}&lt;/span&gt;&lt;/div&gt;
            &lt;/div&gt;

            &lt;button 
            onClick={resetGame}
            className=&quot;w-full bg-white text-gray-900 font-bold py-3 px-8 rounded-xl hover:bg-gray-200 transition&quot;
            &gt;
            <font face="NSimSun, monospace"><span lang="zh-CN">é‡æ–°é–‹å§‹</span></font>
            &lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }

  // 4. Main Game Loop
  const currentLocData = LOCATIONS.find(l =&gt; l.id === location);
  const currentAvatar = AVATARS.find(a =&gt; a.id === player.avatar);

  return (
    &lt;div className=&quot;min-h-screen bg-indigo-50 flex flex-col font-sans text-slate-800&quot;&gt;
      
      {/* Top Bar */}
      &lt;div className=&quot;bg-white/80 backdrop-blur-md shadow-sm p-3 sticky top-0 z-20 border-b border-indigo-100&quot;&gt;
        &lt;div className=&quot;max-w-6xl mx-auto flex flex-col md:flex-row gap-4 items-center justify-between&quot;&gt;
          
          {/* Player Info */}
          &lt;div className=&quot;flex items-center justify-between w-full md:w-auto gap-4&quot;&gt;
              &lt;div className=&quot;flex items-center gap-3 bg-indigo-50 px-4 py-2 rounded-full&quot;&gt;
                &lt;span className=&quot;text-2xl bg-white rounded-full p-1 shadow-sm&quot; role=&quot;img&quot; aria-label=&quot;avatar&quot;&gt;{currentAvatar?.icon}&lt;/span&gt;
                &lt;div&gt;
                  &lt;div className=&quot;font-bold text-indigo-900 leading-none&quot;&gt;{player.name}&lt;/div&gt;
                  &lt;div className=&quot;text-[10px] text-indigo-500 font-bold mt-1 uppercase tracking-wide&quot;&gt;
                    {FACULTIES.find(f =&gt; f.id === player.faculty).name} YEAR 1
                  &lt;/div&gt;
                &lt;/div&gt;
              &lt;/div&gt;
              
              {/* Reset Button (Mobile/Desktop) */}
              &lt;button 
                onClick={resetGame}
                className=&quot;md:hidden p-2 text-gray-500 hover:text-red-500 bg-gray-100 rounded-full&quot;
                title=&quot;<font face="NSimSun, monospace"><span lang="zh-CN">é‡æ–°é–‹å§‹</span></font>&quot;
              &gt;
                &lt;RotateCcw size={18} /&gt;
              &lt;/button&gt;
          &lt;/div&gt;

          {/* Stats Grid */}
          &lt;div className=&quot;flex-1 grid grid-cols-4 gap-2 w-full&quot;&gt;
            &lt;StatBar icon={&lt;Activity size={14} /&gt;} label=&quot;<font face="NSimSun, monospace"><span lang="zh-CN">é«”åŠ›</span></font>&quot; value={stats.energy} color=&quot;bg-rose-500&quot; track=&quot;bg-rose-100&quot; max={120} /&gt;
            &lt;StatBar icon={&lt;Frown size={14} /&gt;} label=&quot;<font face="NSimSun, monospace"><span lang="zh-CN">å£“åŠ›</span></font>&quot; value={stats.stress} color=&quot;bg-slate-600&quot; track=&quot;bg-slate-200&quot; isBad max={100} /&gt;
            &lt;StatBar icon={&lt;BookOpen size={14} /&gt;} label=&quot;<font face="NSimSun, monospace"><span lang="zh-CN">çŸ¥è­˜</span></font>&quot; value={stats.knowledge} color=&quot;bg-sky-500&quot; track=&quot;bg-sky-100&quot; max={100} /&gt;
            &lt;StatBar icon={&lt;Users size={14} /&gt;} label=&quot;<font face="NSimSun, monospace"><span lang="zh-CN">ç¤¾äº¤</span></font>&quot; value={stats.social} color=&quot;bg-amber-500&quot; track=&quot;bg-amber-100&quot; max={100} /&gt;
          &lt;/div&gt;

          {/* Time &amp; Money &amp; Reset */}
          &lt;div className=&quot;flex items-center gap-3 text-sm font-bold w-full md:w-auto justify-end&quot;&gt;
             &lt;div className=&quot;flex items-center text-indigo-600 bg-indigo-50 px-3 py-1 rounded-lg&quot;&gt;
                &lt;Clock size={16} className=&quot;mr-2&quot; /&gt;
                D{time.day} {formatTime(time.hour)}
            &lt;/div&gt;
            &lt;div className=&quot;flex items-center text-emerald-600 bg-emerald-50 px-3 py-1 rounded-lg&quot;&gt;
                &lt;DollarSign size={16} className=&quot;mr-1&quot; /&gt;
                {stats.money}
            &lt;/div&gt;
            
             {/* Reset Button (Desktop) */}
             &lt;button 
                onClick={resetGame}
                className=&quot;hidden md:flex items-center gap-1 px-3 py-1 text-xs text-gray-500 hover:text-red-500 hover:bg-red-50 rounded-lg transition&quot;
                title=&quot;<font face="NSimSun, monospace"><span lang="zh-CN">é‡æ–°é–‹å§‹</span></font>&quot;
              &gt;
                &lt;RotateCcw size={14} /&gt; 
                <font face="NSimSun, monospace"><span lang="zh-CN">é‡æ–°é–‹å§‹</span></font>
              &lt;/button&gt;
          &lt;/div&gt;

        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div className=&quot;flex-1 max-w-6xl mx-auto w-full p-4 grid grid-cols-1 lg:grid-cols-12 gap-6&quot;&gt;
        
        {/* Left Column: Navigation &amp; Relationships (3 cols) */}
        &lt;div className=&quot;lg:col-span-3 space-y-4 flex flex-col&quot;&gt;
            
            {/* Minimap */}
            &lt;div className=&quot;bg-white p-4 rounded-3xl shadow-sm border border-indigo-50&quot;&gt;
                &lt;h3 className=&quot;font-black text-gray-400 text-xs uppercase mb-3 flex items-center tracking-wider&quot;&gt;
                    &lt;MapPin size={14} className=&quot;mr-1&quot;/&gt; <font face="NSimSun, monospace"><span lang="zh-CN">åœ°åœ–å°èˆª</span></font>
                &lt;/h3&gt;
                &lt;div className=&quot;space-y-2&quot;&gt;
                    {LOCATIONS.map(loc =&gt; (
                        &lt;button
                            key={loc.id}
                            disabled={location === loc.id}
                            onClick={() =&gt; handleMove(loc.id)}
                            className={`w-full text-sm py-3 px-4 rounded-xl text-left transition flex items-center justify-between font-bold ${
                                location === loc.id 
                                ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-200 transform scale-105' 
                                : 'bg-gray-50 hover:bg-white hover:shadow-md text-gray-600'
                            }`}
                        &gt;
                            &lt;span&gt;{loc.name}&lt;/span&gt;
                            {location === loc.id &amp;&amp; &lt;div className=&quot;w-2 h-2 bg-white rounded-full animate-pulse&quot;&gt;&lt;/div&gt;}
                        &lt;/button&gt;
                    ))}
                &lt;/div&gt;
            &lt;/div&gt;

            {/* Relationships Panel */}
            &lt;div className=&quot;bg-white p-4 rounded-3xl shadow-sm border border-indigo-50 flex-1&quot;&gt;
                &lt;h3 className=&quot;font-black text-gray-400 text-xs uppercase mb-3 flex items-center tracking-wider&quot;&gt;
                    &lt;HeartHandshake size={14} className=&quot;mr-1&quot;/&gt; <font face="NSimSun, monospace"><span lang="zh-CN">äººéš›é—œä¿‚</span></font>
                &lt;/h3&gt;
                &lt;div className=&quot;space-y-4&quot;&gt;
                    {relationships.map(npc =&gt; (
                        &lt;div key={npc.id} className=&quot;group&quot;&gt;
                            &lt;div className=&quot;flex justify-between items-end mb-1&quot;&gt;
                                &lt;span className=&quot;text-sm font-bold text-gray-700&quot;&gt;{npc.name}&lt;/span&gt;
                                &lt;span className=&quot;text-xs text-gray-400&quot;&gt;{npc.level}/100&lt;/span&gt;
                            &lt;/div&gt;
                            &lt;div className=&quot;w-full bg-gray-100 rounded-full h-2 mb-1 overflow-hidden&quot;&gt;
                                &lt;div 
                                    className={`h-full rounded-full transition-all duration-700 ${
                                        npc.level &gt; 80 ? 'bg-pink-500' : 
                                        npc.level &gt; 50 ? 'bg-indigo-400' : 'bg-gray-400'
                                    }`} 
                                    style={{ width: `${npc.level}%` }}
                                &gt;&lt;/div&gt;
                            &lt;/div&gt;
                            &lt;p className=&quot;text-[10px] text-gray-400 group-hover:text-indigo-500 transition-colors truncate&quot;&gt;
                                {npc.desc}
                            &lt;/p&gt;
                        &lt;/div&gt;
                    ))}
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        {/* Center Column: Main Action Area (6 cols) */}
        &lt;div className=&quot;lg:col-span-6 flex flex-col&quot;&gt;
            &lt;div className=&quot;bg-white rounded-3xl shadow-xl overflow-hidden min-h-[500px] flex flex-col border-4 border-white ring-4 ring-indigo-50 transition-all&quot;&gt;
                {/* Header */}
                &lt;div className={`${currentLocData.color} p-8 text-indigo-900 relative overflow-hidden`}&gt;
                    &lt;div className=&quot;relative z-10&quot;&gt;
                        &lt;h2 className=&quot;text-3xl font-black flex items-center mb-2&quot;&gt;
                            {currentLocData.name}
                        &lt;/h2&gt;
                        &lt;p className=&quot;text-indigo-800/70 font-medium&quot;&gt;{currentLocData.description}&lt;/p&gt;
                    &lt;/div&gt;
                    {/* Decorative Circles */}
                    &lt;div className=&quot;absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white/20 rounded-full blur-2xl&quot;&gt;&lt;/div&gt;
                    &lt;div className=&quot;absolute bottom-0 left-0 -mb-10 -ml-10 w-24 h-24 bg-white/30 rounded-full blur-xl&quot;&gt;&lt;/div&gt;
                &lt;/div&gt;

                {/* Content */}
                &lt;div className=&quot;p-6 flex-1 bg-white relative&quot;&gt;
                    &lt;h3 className=&quot;font-bold text-gray-400 text-xs uppercase mb-4 tracking-wider&quot;&gt;<font face="NSimSun, monospace"><span lang="zh-CN">å¯åŸ·è¡Œè¡Œå‹•</span></font>&lt;/h3&gt;
                    &lt;div className=&quot;grid grid-cols-1 sm:grid-cols-2 gap-4&quot;&gt;
                        {currentLocData.actions.map(actionKey =&gt; {
                            const action = ACTIONS_DB[actionKey];
                            return (
                                &lt;button
                                    key={actionKey}
                                    onClick={() =&gt; handleAction(actionKey)}
                                    className=&quot;bg-gray-50 p-5 rounded-2xl border-2 border-transparent hover:border-indigo-500 hover:bg-white hover:shadow-xl transition-all duration-300 flex flex-col items-start text-left group&quot;
                                &gt;
                                    &lt;span className=&quot;font-bold text-lg text-gray-800 group-hover:text-indigo-600 mb-2 w-full border-b border-gray-200 pb-2 group-hover:border-indigo-100&quot;&gt;
                                        {action.label}
                                    &lt;/span&gt;
                                    
                                    &lt;div className=&quot;w-full space-y-2&quot;&gt;
                                      &lt;div className=&quot;flex flex-wrap gap-2 text-xs font-medium&quot;&gt;
                                          {action.energy !== 0 &amp;&amp; &lt;span className={`px-2 py-1 rounded-md ${action.energy &lt; 0 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}`}&gt;âš¡ {action.energy}&lt;/span&gt;}
                                          {action.stress !== 0 &amp;&amp; &lt;span className={`px-2 py-1 rounded-md ${action.stress &gt; 0 ? 'bg-gray-200 text-gray-600' : 'bg-blue-100 text-blue-600'}`}&gt;ğŸ˜“ {action.stress &gt; 0 ? '+' : ''}{action.stress}&lt;/span&gt;}
                                          {action.money !== 0 &amp;&amp; &lt;span className={`px-2 py-1 rounded-md ${action.money &lt; 0 ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-600'}`}&gt;ğŸ’° {action.money}&lt;/span&gt;}
                                          {action.time !== 0 &amp;&amp; &lt;span className=&quot;px-2 py-1 rounded-md bg-indigo-50 text-indigo-500 ml-auto flex items-center&quot;&gt;&lt;Clock size={10} className=&quot;mr-1&quot;/&gt;{action.time}h&lt;/span&gt;}
                                    &lt;/div&gt;
                                      
                                      {action.npc &amp;&amp; (
                                        &lt;div className=&quot;text-xs text-pink-500 flex items-center pt-1&quot;&gt;
                                          &lt;Heart size={10} className=&quot;mr-1&quot; /&gt;
                                          {relationships.find(r =&gt; r.id === action.npc)?.name} {action.npcVal &gt; 0 ? '+' : ''}{action.npcVal}
                                        &lt;/div&gt;
                                      )}
                                    &lt;/div&gt;
                                &lt;/button&gt;
                            );
                        })}
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        {/* Right Column: Log (3 cols) */}
        &lt;div className=&quot;lg:col-span-3&quot;&gt;
            &lt;div className=&quot;bg-white p-5 rounded-3xl shadow-sm border border-indigo-50 h-[calc(100vh-140px)] sticky top-24 flex flex-col&quot;&gt;
                &lt;h3 className=&quot;font-black text-gray-400 text-xs uppercase mb-4 flex items-center tracking-wider&quot;&gt;
                    &lt;Briefcase size={14} className=&quot;mr-1&quot;/&gt; <font face="NSimSun, monospace"><span lang="zh-CN">å†’éšªæ—¥èªŒ</span></font>
                &lt;/h3&gt;
                &lt;div className=&quot;flex-1 overflow-y-auto text-sm space-y-3 pr-2 custom-scrollbar&quot;&gt;
                {logs.length === 0 &amp;&amp; &lt;p className=&quot;text-gray-400 italic text-center mt-10&quot;&gt;<font face="NSimSun, monospace"><span lang="zh-CN">å†’éšªå³å°‡é–‹å§‹</span></font>...&lt;/p&gt;}
                {logs.map((log, i) =&gt; (
                    &lt;div key={i} className=&quot;bg-gray-50 p-3 rounded-xl text-gray-600 border border-gray-100 text-xs leading-relaxed animate-fade-in&quot;&gt;
                        {log}
                    &lt;/div&gt;
                ))}
                &lt;div ref={logsEndRef} /&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

      &lt;/div&gt;

      {/* Random Event Popup Overlay */}
      {popup &amp;&amp; (
        &lt;div className=&quot;fixed inset-0 bg-indigo-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4&quot;&gt;
            &lt;div className=&quot;bg-white rounded-3xl shadow-2xl max-w-md w-full overflow-hidden animate-bounce-in border-4 border-white&quot;&gt;
                &lt;div className=&quot;bg-yellow-400 p-6 text-white font-black text-xl flex items-center justify-center shadow-inner&quot;&gt;
                    &lt;span className=&quot;mr-2 bg-white/20 p-2 rounded-full&quot;&gt;{popup.icon || &lt;AlertTriangle /&gt;}&lt;/span&gt;
                    {popup.title}
                &lt;/div&gt;
                &lt;div className=&quot;p-8&quot;&gt;
                    &lt;p className=&quot;text-gray-600 text-lg mb-8 font-medium text-center leading-relaxed&quot;&gt;{popup.desc}&lt;/p&gt;
                    &lt;div className=&quot;space-y-3&quot;&gt;
                        {popup.choices.map((choice, idx) =&gt; (
                            &lt;button
                                key={idx}
                                onClick={() =&gt; handleEventChoice(choice)}
                                className=&quot;w-full bg-gray-50 hover:bg-indigo-50 text-gray-800 hover:text-indigo-700 font-bold py-4 px-6 rounded-2xl transition border-2 border-gray-100 hover:border-indigo-200 shadow-sm hover:shadow-md text-left&quot;
                            &gt;
                                {choice.text}
                            &lt;/button&gt;
                        ))}
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
      )}

    &lt;/div&gt;
  );
}

// Sub-component for Progress Bars
function StatBar({ icon, label, value, color, track, max }) {
  const percentage = Math.min(100, Math.max(0, (value / max) * 100));
  return (
    &lt;div className=&quot;bg-white border border-gray-100 rounded-xl p-2 flex flex-col justify-center shadow-sm&quot;&gt;
      &lt;div className=&quot;flex items-center justify-between mb-1&quot;&gt;
        &lt;div className=&quot;flex items-center text-gray-500 text-xs font-bold gap-1&quot;&gt;
            {icon} {label}
        &lt;/div&gt;
        &lt;span className=&quot;text-[10px] font-mono text-gray-400&quot;&gt;{value}&lt;/span&gt;
      &lt;/div&gt;
      &lt;div className={`w-full ${track} rounded-full h-1.5`}&gt;
        &lt;div 
          className={`h-1.5 rounded-full transition-all duration-500 ${color}`} 
          style={{ width: `${percentage}%` }}
        &gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}</pre>
</body>
</html>
